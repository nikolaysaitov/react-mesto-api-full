{"ast":null,"code":"import _toConsumableArray from\"/Users/nikolay/Desktop/react-mesto-api-full/frontend/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _objectSpread from\"/Users/nikolay/Desktop/react-mesto-api-full/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/Users/nikolay/Desktop/react-mesto-api-full/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState,useEffect}from\"react\";import{Route,Switch,useHistory}from\"react-router-dom\";import Header from\"./Header\";import Main from\"./Main\";import Footer from\"./Footer\";import PopupWithForm from\"./PopupWithForm\";import ImagePopup from\"./ImagePopup\";import{api}from\"../utils/Api\";import{CurrentUserContext}from\"../contexts/CurrentUserContext\";import EditProfilePopup from\"./EditProfilePopup\";import EditAvatarPopup from\"./EditAvatarPopup\";import AddPlacePopup from\"./AddPlacePopup\";import Login from\"./Login\";import*as auth from\"../utils/auth.js\";import ProtectedRoute from\"./ProtectedRoute\";import Register from\"./Register\";import InfoTooltip from\"./InfoTooltip\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function App(){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isEditAvatarPopupOpen=_useState2[0],setIsEditAvatarPopupOpen=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isEditProfilePopupOpen=_useState4[0],setIsEditProfilePopupOpen=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isAddPlacePopupOpen=_useState6[0],setIsAddPlacePopupOpen=_useState6[1];var _useState7=useState({}),_useState8=_slicedToArray(_useState7,2),selectedCard=_useState8[0],setSelectedCard=_useState8[1];var _useState9=useState({}),_useState10=_slicedToArray(_useState9,2),currentUser=_useState10[0],setCurrentUser=_useState10[1];var _useState11=useState([]),_useState12=_slicedToArray(_useState11,2),cards=_useState12[0],setCards=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),loggedIn=_useState14[0],setLoggedIn=_useState14[1];var _useState15=useState(\"\"),_useState16=_slicedToArray(_useState15,2),email=_useState16[0],setEmail=_useState16[1];var history=useHistory();var _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),isReg=_useState18[0],setIsReg=_useState18[1];var _useState19=useState(false),_useState20=_slicedToArray(_useState19,2),isInfoPopupOpen=_useState20[0],setInfoPopupOpen=_useState20[1];var token=localStorage.getItem('jwt');var handleEditAvatarClick=function handleEditAvatarClick(){setIsEditAvatarPopupOpen(true);};var handleEditProfileClick=function handleEditProfileClick(){setIsEditProfilePopupOpen(true);};var handleAddPlaceClick=function handleAddPlaceClick(){setIsAddPlacePopupOpen(true);};var handleCardClick=function handleCardClick(card){setSelectedCard({isOpened:true,name:card.name,link:card.link});};function closeAllPopups(){setIsEditAvatarPopupOpen(false);setIsEditProfilePopupOpen(false);setIsAddPlacePopupOpen(false);setInfoPopupOpen(false);setSelectedCard(_objectSpread(_objectSpread({},selectedCard),{},{isOpened:false}));}useEffect(function(){handleTokenCheck();if(loggedIn){Promise.all([api.getProfile(),api.getInitialCards()]).then(function(_ref){var _ref2=_slicedToArray(_ref,2),userData=_ref2[0],cardData=_ref2[1];setCurrentUser(userData);setCards(cardData);}).catch(function(err){return console.log(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430 \".concat(err));});}},[loggedIn]);var isOpen=isEditAvatarPopupOpen||isEditProfilePopupOpen||isAddPlacePopupOpen||selectedCard||isInfoPopupOpen;useEffect(function(){function closeByEscape(event){if(event.key===\"Escape\"){closeAllPopups();}}if(isOpen){document.addEventListener(\"keydown\",closeByEscape);return function(){document.removeEventListener(\"keydown\",closeByEscape);};}},[isOpen]);useEffect(function(){if(!isOpen)return;function handleOverley(event){if(event.target.classList.contains(\"popup_open\")||event.target.classList.contains(\"popup__close\")){closeAllPopups();}}document.addEventListener(\"mousedown\",handleOverley);return function(){return document.removeEventListener(\"mousedown\",handleOverley);};},[isOpen]);useEffect(function(){api.getProfile(token).then(function(res){return setCurrentUser(res);}).catch(function(err){return console.log(err);});},[]);useEffect(function(){api.getInitialCards(token).then(function(cards){return setCards(cards);}).catch(function(err){return console.log(err);});},[]);function handleCardLike(card){// Снова проверяем, есть ли уже лайк на этой карточке\nvar isLiked=card.likes.some(function(i){return i._id===currentUser._id;});// Отправляем запрос в API и получаем обновлённые данные карточки\nvar changeLikeCardStatus=!isLiked?api.addLike(card._id):api.deleteLike(card._id);changeLikeCardStatus.then(function(newCard){setCards(function(item){return item.map(function(c){return c._id===card._id?newCard:c;});});}).catch(function(err){return console.log(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430 \".concat(err));});}var handleCardDelete=function handleCardDelete(card){api.deleteCard(card._id).then(function(){setCards(function(cards){return cards.filter(function(c){return c._id!==card._id;});});closeAllPopups();}).catch(function(err){return console.log(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430 \".concat(err));});};var handleUpdateUser=function handleUpdateUser(name,about){api.editProfile(name,about).then(function(item){setCurrentUser(item);closeAllPopups();}).catch(function(err){return console.log(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430 \".concat(err));});};var handleUpdateAvatar=function handleUpdateAvatar(avatar){api.updateAvatar(avatar.avatar).then(function(item){setCurrentUser(item);closeAllPopups();}).catch(function(err){return console.log(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430 \".concat(err));});};var handleAddPlaceSubmit=function handleAddPlaceSubmit(name,link){api.addCard(name,link).then(function(newCard){setCards([newCard].concat(_toConsumableArray(cards)));closeAllPopups();}).catch(function(err){return console.log(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430 \".concat(err));});};function handleLogin(){setLoggedIn(true);}function handleLoginSubmit(email,password){auth.authorize(email,password).then(function(data){localStorage.setItem(\"jwt\",data.token);setEmail(email);handleLogin();history.push(\"/\");}).catch(function(err){setInfoPopupOpen(true);console.log(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430 \\u0432\\u0445\\u043E\\u0434\\u0430 \".concat(err));setIsReg(false);});}function handleRegistrSubmit(email,password){auth.register(email,password).then(function(res){if(res){setIsReg(true);history.push(\"/sign-in\");}else{setIsReg(false);console.log(\"else\");}}).catch(function(err){console.log(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430 \\u0432\\u0445\\u043E\\u0434\\u0430 \".concat(err));setIsReg(false);}).finally(function(){setInfoPopupOpen(true);});}function handleExit(){localStorage.removeItem(\"jwt\");setLoggedIn(false);history.push(\"/sign-in\");}function handleTokenCheck(){var jwt=localStorage.getItem(\"jwt\");if(jwt){auth.checkToken(jwt).then(function(res){handleLogin();history.push(\"/\");setEmail(res.data.email);}).catch(function(err){return console.log(err);});}}return/*#__PURE__*/_jsx(\"div\",{className:\"page\",children:/*#__PURE__*/_jsxs(CurrentUserContext.Provider,{value:currentUser,children:[/*#__PURE__*/_jsx(Header,{email:email,onExit:handleExit}),/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsx(ProtectedRoute,{exact:true,path:\"/\",loggedIn:loggedIn,component:Main,onEditAvatar:handleEditAvatarClick,onEditProfile:handleEditProfileClick,onAddPlace:handleAddPlaceClick,onCardClick:handleCardClick,onCardLike:handleCardLike,cards:cards,onCardDelete:handleCardDelete}),/*#__PURE__*/_jsx(Route,{path:\"/sign-in\",children:/*#__PURE__*/_jsx(Login,{handleLogin:handleLogin,onSubmit:handleLoginSubmit})}),/*#__PURE__*/_jsx(Route,{path:\"/sign-up\",children:/*#__PURE__*/_jsx(Register,{handleLogin:handleLogin,onSubmit:handleRegistrSubmit})})]}),/*#__PURE__*/_jsx(InfoTooltip,{isOPen:isInfoPopupOpen,isReg:isReg}),loggedIn&&/*#__PURE__*/_jsx(Footer,{}),/*#__PURE__*/_jsx(EditProfilePopup,{isOpen:isEditProfilePopupOpen,onClose:closeAllPopups,onUpdateUser:handleUpdateUser}),/*#__PURE__*/_jsx(EditAvatarPopup,{isOpen:isEditAvatarPopupOpen,onClose:closeAllPopups,onUpdateAvatar:handleUpdateAvatar}),/*#__PURE__*/_jsx(AddPlacePopup,{isOpen:isAddPlacePopupOpen,onClose:closeAllPopups,onAddPlace:handleAddPlaceSubmit}),/*#__PURE__*/_jsx(PopupWithForm,{name:\"formDelete\",title:\"\\u0412\\u044B \\u0443\\u0432\\u0435\\u0440\\u0435\\u043D\\u044B?\",id:\"popup__form popup__form_add\",formName:\"formDelete\",buttonText:\"\\u0414\\u0430\",onClose:closeAllPopups,children:/*#__PURE__*/_jsx(\"input\",{name:\"formDelete\",className:\"popup__form popup__form_add\"})}),/*#__PURE__*/_jsx(ImagePopup,{selectedCard:selectedCard,onClose:closeAllPopups})]})});}export default App;","map":{"version":3,"sources":["/Users/nikolay/Desktop/react-mesto-api-full/frontend/src/components/App.js"],"names":["React","useState","useEffect","Route","Switch","useHistory","Header","Main","Footer","PopupWithForm","ImagePopup","api","CurrentUserContext","EditProfilePopup","EditAvatarPopup","AddPlacePopup","Login","auth","ProtectedRoute","Register","InfoTooltip","App","isEditAvatarPopupOpen","setIsEditAvatarPopupOpen","isEditProfilePopupOpen","setIsEditProfilePopupOpen","isAddPlacePopupOpen","setIsAddPlacePopupOpen","selectedCard","setSelectedCard","currentUser","setCurrentUser","cards","setCards","loggedIn","setLoggedIn","email","setEmail","history","isReg","setIsReg","isInfoPopupOpen","setInfoPopupOpen","token","localStorage","getItem","handleEditAvatarClick","handleEditProfileClick","handleAddPlaceClick","handleCardClick","card","isOpened","name","link","closeAllPopups","handleTokenCheck","Promise","all","getProfile","getInitialCards","then","userData","cardData","catch","err","console","log","isOpen","closeByEscape","event","key","document","addEventListener","removeEventListener","handleOverley","target","classList","contains","res","handleCardLike","isLiked","likes","some","i","_id","changeLikeCardStatus","addLike","deleteLike","newCard","item","map","c","handleCardDelete","deleteCard","filter","handleUpdateUser","about","editProfile","handleUpdateAvatar","avatar","updateAvatar","handleAddPlaceSubmit","addCard","handleLogin","handleLoginSubmit","password","authorize","data","setItem","push","handleRegistrSubmit","register","finally","handleExit","removeItem","jwt","checkToken"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { Route, Switch, useHistory } from \"react-router-dom\";\nimport Header from \"./Header\";\nimport Main from \"./Main\";\nimport Footer from \"./Footer\";\nimport PopupWithForm from \"./PopupWithForm\";\nimport ImagePopup from \"./ImagePopup\";\nimport { api } from \"../utils/Api\";\nimport { CurrentUserContext } from \"../contexts/CurrentUserContext\";\nimport EditProfilePopup from \"./EditProfilePopup\";\nimport EditAvatarPopup from \"./EditAvatarPopup\";\nimport AddPlacePopup from \"./AddPlacePopup\";\nimport Login from \"./Login\";\nimport * as auth from \"../utils/auth.js\";\nimport ProtectedRoute from \"./ProtectedRoute\";\nimport Register from \"./Register\";\nimport InfoTooltip from \"./InfoTooltip\";\n\nfunction App() {\n  const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] = useState(false);\n  const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] = useState(false);\n  const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = useState(false);\n  const [selectedCard, setSelectedCard] = useState({});\n  const [currentUser, setCurrentUser] = useState({});\n  const [cards, setCards] = useState([]);\n  const [loggedIn, setLoggedIn] = useState(false);\n  const [email, setEmail] = useState(\"\");\n  const history = useHistory();\n  const [isReg, setIsReg] = useState(false);\n  const [isInfoPopupOpen, setInfoPopupOpen] = useState(false);\n  const token = localStorage.getItem('jwt');\n\n  const handleEditAvatarClick = () => {\n    setIsEditAvatarPopupOpen(true);\n  };\n\n  const handleEditProfileClick = () => {\n    setIsEditProfilePopupOpen(true);\n  };\n\n  const handleAddPlaceClick = () => {\n    setIsAddPlacePopupOpen(true);\n  };\n\n  const handleCardClick = (card) => {\n    setSelectedCard({\n      isOpened: true,\n      name: card.name,\n      link: card.link,\n    });\n  };\n\n  function closeAllPopups() {\n    setIsEditAvatarPopupOpen(false);\n    setIsEditProfilePopupOpen(false);\n    setIsAddPlacePopupOpen(false);\n    setInfoPopupOpen(false);\n    setSelectedCard({ ...selectedCard, isOpened: false });\n  }\n\n  useEffect(() => {\n    handleTokenCheck();\n    if (loggedIn) {\n      Promise.all([api.getProfile(), api.getInitialCards()])\n        .then(([userData, cardData]) => {\n          setCurrentUser(userData);\n          setCards(cardData);\n        })\n        .catch((err) => console.log(`Ошибка ${err}`));\n    }\n  }, [loggedIn]);\n\n  const isOpen =\n    isEditAvatarPopupOpen ||\n    isEditProfilePopupOpen ||\n    isAddPlacePopupOpen ||\n    selectedCard ||\n    isInfoPopupOpen;\n\n  useEffect(() => {\n    function closeByEscape(event) {\n      if (event.key === \"Escape\") {\n        closeAllPopups();\n      }\n    }\n    if (isOpen) {\n      document.addEventListener(\"keydown\", closeByEscape);\n      return () => {\n        document.removeEventListener(\"keydown\", closeByEscape);\n      };\n    }\n  }, [isOpen]);\n\n  useEffect(() => {\n    if (!isOpen) return;\n    function handleOverley(event) {\n      if (\n        event.target.classList.contains(\"popup_open\") ||\n        event.target.classList.contains(\"popup__close\")\n      ) {\n        closeAllPopups();\n      }\n    }\n    document.addEventListener(\"mousedown\", handleOverley);\n    return () => document.removeEventListener(\"mousedown\", handleOverley);\n  }, [isOpen]);\n\n  useEffect(() => {\n    api\n      .getProfile(token)\n      .then((res) => setCurrentUser(res))\n      .catch((err) => console.log(err));\n  }, []);\n\n  useEffect(() => {\n    api\n      .getInitialCards(token)\n      .then((cards) => setCards(cards))\n      .catch((err) => console.log(err));\n  }, []);\n\n  function handleCardLike(card) {\n    // Снова проверяем, есть ли уже лайк на этой карточке\n    const isLiked = card.likes.some((i) => i._id === currentUser._id);\n\n    // Отправляем запрос в API и получаем обновлённые данные карточки\n    const changeLikeCardStatus = !isLiked\n      ? api.addLike(card._id)\n      : api.deleteLike(card._id);\n    changeLikeCardStatus\n      .then((newCard) => {\n        setCards((item) => item.map((c) => (c._id === card._id ? newCard : c)));\n      })\n      .catch((err) => console.log(`Ошибка ${err}`));\n  }\n\n  const handleCardDelete = (card) => {\n    api\n      .deleteCard(card._id)\n      .then(() => {\n        setCards((cards) => cards.filter((c) => c._id !== card._id));\n        closeAllPopups();\n      })\n      .catch((err) => console.log(`Ошибка ${err}`));\n  };\n\n  const handleUpdateUser = (name, about) => {\n    api\n      .editProfile(name, about)\n      .then((item) => {\n        setCurrentUser(item);\n        closeAllPopups();\n      })\n      .catch((err) => console.log(`Ошибка ${err}`));\n  };\n  const handleUpdateAvatar = (avatar) => {\n    api\n      .updateAvatar(avatar.avatar)\n      .then((item) => {\n        setCurrentUser(item);\n        closeAllPopups();\n      })\n      .catch((err) => console.log(`Ошибка ${err}`));\n  };\n  const handleAddPlaceSubmit = (name, link) => {\n    api\n      .addCard(name, link)\n      .then((newCard) => {\n        setCards([newCard, ...cards]);\n        closeAllPopups();\n      })\n      .catch((err) => console.log(`Ошибка ${err}`));\n  };\n\n  function handleLogin() {\n    setLoggedIn(true);\n  }\n  function handleLoginSubmit(email, password) {\n    auth\n      .authorize(email, password)\n      .then((data) => {\n        localStorage.setItem(\"jwt\", data.token);\n        setEmail(email);\n        handleLogin();\n        history.push(\"/\");\n      })\n      .catch((err) => {\n        setInfoPopupOpen(true);\n        console.log(`Ошибка входа ${err}`);\n        setIsReg(false);\n      });\n  }\n\n  function handleRegistrSubmit(email, password) {\n    auth\n      .register(email, password)\n      .then((res) => {\n        if (res) {\n          setIsReg(true);\n          history.push(\"/sign-in\");\n        } else {\n          setIsReg(false);\n          console.log(\"else\");\n        }\n      })\n      .catch((err) => {\n        console.log(`Ошибка входа ${err}`);\n        setIsReg(false);\n      })\n      .finally(() => {\n        setInfoPopupOpen(true);\n      });\n  }\n\n  function handleExit() {\n    localStorage.removeItem(\"jwt\");\n    setLoggedIn(false);\n    history.push(\"/sign-in\");\n  }\n\n  function handleTokenCheck() {\n    const jwt = localStorage.getItem(\"jwt\");\n    if (jwt) {\n      auth\n        .checkToken(jwt)\n        .then((res) => {\n          handleLogin();\n          history.push(\"/\");\n          setEmail(res.data.email);\n        })\n        .catch((err) => console.log(err));\n    }\n  }\n\n  return (\n    \n    <div className=\"page\">\n      <CurrentUserContext.Provider value={currentUser}>\n        <Header email={email} onExit={handleExit} />\n        \n        <Switch>\n       \n          <ProtectedRoute\n            exact\n            path=\"/\"\n            loggedIn={loggedIn}\n            component={Main}\n            onEditAvatar={handleEditAvatarClick}\n            onEditProfile={handleEditProfileClick}\n            onAddPlace={handleAddPlaceClick}\n            onCardClick={handleCardClick}\n            onCardLike={handleCardLike}\n            cards={cards}\n            onCardDelete={handleCardDelete}\n          />\n          <Route path=\"/sign-in\">\n            <Login handleLogin={handleLogin} onSubmit={handleLoginSubmit} />\n          </Route>\n\n          <Route path=\"/sign-up\">\n            <Register\n              handleLogin={handleLogin}\n              onSubmit={handleRegistrSubmit}\n            />\n          </Route>\n          \n        </Switch>\n       \n        <InfoTooltip isOPen={isInfoPopupOpen} isReg={isReg} />\n\n        {loggedIn && <Footer />}\n        <EditProfilePopup\n          isOpen={isEditProfilePopupOpen}\n          onClose={closeAllPopups}\n          onUpdateUser={handleUpdateUser}\n        />\n        <EditAvatarPopup\n          isOpen={isEditAvatarPopupOpen}\n          onClose={closeAllPopups}\n          onUpdateAvatar={handleUpdateAvatar}\n        />\n        <AddPlacePopup\n          isOpen={isAddPlacePopupOpen}\n          onClose={closeAllPopups}\n          onAddPlace={handleAddPlaceSubmit}\n        />\n        {/* попап вы уверены? */}\n        <PopupWithForm\n          name=\"formDelete\"\n          title=\"Вы уверены?\"\n          id=\"popup__form popup__form_add\"\n          formName=\"formDelete\"\n          buttonText=\"Да\"\n          onClose={closeAllPopups}\n        >\n          <input name=\"formDelete\" className=\"popup__form popup__form_add\" />\n        </PopupWithForm>\n\n        {/* попап открытия картинки */}\n        <ImagePopup selectedCard={selectedCard} onClose={closeAllPopups} />\n      </CurrentUserContext.Provider>\n    </div>\n   \n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}